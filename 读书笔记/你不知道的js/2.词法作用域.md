# 第二章 词法作用域

## 词法阶段

简单地说，此法作用域就是定义在词法阶段的作用域。换句话说，此法作用域就是由你在写代码时将变量和块作用域写在哪里来决定的，因此词法分析器处理代码时会保持作用域不变。

考虑以下代码：

```js
function foo(a) {
    var b = a * 2;

    function bar(c) {
        console.log(a, b, c);
    }

    bar(b * 3);
}

foo(2); // 2, 4, 12
```

可以将它们想象成几个逐级包含的气泡

[![作用域气泡](https://s1.ax1x.com/2020/05/07/YZ0jSO.png)](https://imgchr.com/i/YZ0jSO)

### 查找

作用域气泡的结构和互相之间的位置关系给引擎提供了足够的位置信息，引擎用这些信息来查找标识符的位置。**作用域查找会在找到第一个匹配的标识符时停止。**。 在多层的嵌套作用域中可以定义同名的标识符，这叫作“遮蔽效应”（内部的标识符“遮蔽”了外部的标识符）。抛开遮蔽效应，作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见第一个匹配的标识符为止。

如果全局变量被遮蔽，使用 window.a 的形式即可绕过遮蔽进行访问。

**无论函数在哪里被调用，也无论它如何被调用，它的此法作用域都只由函数被声明时所处的位置决定。**

```js
function foo() {
    var a = 200;
    bar();
}

function bar() {
    console.log(a); //100
}

var a = 100;

foo();
```

虽然bar在foo中被调用，但是bar是定义在全局的，也就是说，bar的词法作用域嵌套关系为（由内到外）：bar内部的词法作用域->全局作用域。所以foo中的a并不影响输出结果，除此之外，使用apply，call等也不能影响结果。


